{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "D:\\MAXNATE\\DEVELOPMENT\\Websites\\swai-electronics-backup-20251126-193107\\serverless\\cloudflare-worker\\.wrangler\\tmp\\deploy-rWCAfA",
  "sourcesContent": ["export default {\r\n  async fetch(request, env) {\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { headers: corsHeaders(request, env) });\r\n    }\r\n\r\n    try {\r\n      const url = new URL(request.url);\r\n      if (url.pathname === '/update-file' && request.method === 'POST') {\r\n        if (env.REQUIRE_AUTH === 'true') {\r\n          const claims = await verifyClerkJWT(request, env);\r\n          if (!claims) return json({ error: 'Unauthorized' }, 401, request, env);\r\n        }\r\n\r\n        const body = await request.json();\r\n        const { owner, repo, branch, path, content, message, sha } = body || {};\r\n        if (!owner || !repo || !path || !content || !message) {\r\n          return json({ error: 'Missing fields' }, 400, request, env);\r\n        }\r\n\r\n        const ghRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`, {\r\n          method: 'PUT',\r\n          headers: {\r\n            'Authorization': `token ${env.GH_TOKEN}`,\r\n            'Accept': 'application/vnd.github+json',\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            message,\r\n            content: btoa(content),\r\n            branch: branch || 'master',\r\n            sha\r\n          })\r\n        });\r\n\r\n        if (!ghRes.ok) {\r\n          const txt = await ghRes.text();\r\n          return json({ error: 'GitHub error', status: ghRes.status, details: txt }, 502, request, env);\r\n        }\r\n\r\n        const data = await ghRes.json();\r\n        return json({ ok: true, content: data.content, commit: data.commit.sha }, 200, request, env);\r\n      }\r\n\r\n      return json({ error: 'Not found' }, 404, request, env);\r\n    } catch (e) {\r\n      return json({ error: e.message || 'Server error' }, 500, request, env);\r\n    }\r\n  }\r\n}\r\n\r\nfunction corsHeaders(request, env) {\r\n  const origin = request.headers.get('Origin') || '*';\r\n  const allowOrigins = (env.CORS_ORIGINS || '').split(',').map(s => s.trim()).filter(Boolean);\r\n  const allowed = allowOrigins.length ? (allowOrigins.includes(origin) ? origin : allowOrigins[0]) : origin;\r\n  return {\r\n    'Access-Control-Allow-Origin': allowed,\r\n    'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    'Vary': 'Origin'\r\n  };\r\n}\r\n\r\nfunction json(obj, status, request, env) {\r\n  return new Response(JSON.stringify(obj), { status, headers: { 'Content-Type': 'application/json', ...corsHeaders(request, env) } });\r\n}\r\n\r\n// ===== Clerk JWT verification (RS256 via JWKS) =====\r\nlet JWKS_CACHE = { keys: [], fetchedAt: 0 };\r\n\r\nasync function getJWKS(env) {\r\n  const url = env.CLERK_JWKS_URL;\r\n  if (!url) throw new Error('CLERK_JWKS_URL not configured');\r\n  const now = Date.now();\r\n  if (JWKS_CACHE.keys.length && now - JWKS_CACHE.fetchedAt < 5 * 60 * 1000) {\r\n    return JWKS_CACHE.keys;\r\n  }\r\n  const res = await fetch(url, { cf: { cacheTtl: 300 } });\r\n  if (!res.ok) throw new Error('Failed to fetch JWKS');\r\n  const data = await res.json();\r\n  JWKS_CACHE = { keys: data.keys || [], fetchedAt: now };\r\n  return JWKS_CACHE.keys;\r\n}\r\n\r\nfunction b64urlToUint8Array(b64url) {\r\n  const pad = '='.repeat((4 - (b64url.length % 4)) % 4);\r\n  const base64 = (b64url.replace(/-/g, '+').replace(/_/g, '/')) + pad;\r\n  const str = atob(base64);\r\n  const bytes = new Uint8Array(str.length);\r\n  for (let i = 0; i < str.length; i++) bytes[i] = str.charCodeAt(i);\r\n  return bytes;\r\n}\r\n\r\nasync function verifyClerkJWT(request, env) {\r\n  const auth = request.headers.get('Authorization') || '';\r\n  if (!auth.startsWith('Bearer ')) return null;\r\n  const token = auth.slice('Bearer '.length).trim();\r\n  const [encHeader, encPayload, encSignature] = token.split('.');\r\n  if (!encHeader || !encPayload || !encSignature) return null;\r\n\r\n  const header = JSON.parse(new TextDecoder().decode(b64urlToUint8Array(encHeader)));\r\n  const payloadBytes = b64urlToUint8Array(encPayload);\r\n  const payload = JSON.parse(new TextDecoder().decode(payloadBytes));\r\n\r\n  // exp check\r\n  if (payload.exp && Date.now() / 1000 > payload.exp) return null;\r\n\r\n  // Optional issuer check\r\n  if (env.CLERK_ISSUER && payload.iss && !String(payload.iss).startsWith(env.CLERK_ISSUER)) return null;\r\n\r\n  const jwks = await getJWKS(env);\r\n  const jwk = jwks.find(k => k.kid === header.kid && k.kty === 'RSA');\r\n  if (!jwk) return null;\r\n\r\n  const key = await crypto.subtle.importKey(\r\n    'jwk',\r\n    jwk,\r\n    { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' },\r\n    false,\r\n    ['verify']\r\n  );\r\n\r\n  const signature = b64urlToUint8Array(encSignature);\r\n  const signingInput = new TextEncoder().encode(`${encHeader}.${encPayload}`);\r\n  const ok = await crypto.subtle.verify('RSASSA-PKCS1-v1_5', key, signature, signingInput);\r\n  return ok ? payload : null;\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
